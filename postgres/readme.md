## Installing Postgres

These are the install notes for installing postgresql in the k8s cluster. This uses the bitnami helm chart, so all
the notes and customizations are targeted for that pattern. Before beginning, we need to set up a place for
the database to store the actual data in the database, so that it persists between pod restarts, etc. Since all
the other systems in malwarETL are using an external NAS for that storage and mounting the drives over SMB, we'll do
that here, too. You will need to set that up yourself, since I don't know what NAS you might be using. But, do 
keep track of the username/password used and the path to that SMB share, you'll need it in a sec.

By default the settings in `values.yaml` are what malwarETL is expecting, but you may want to change the 
`loadBalancerIP` value to whatever range you have for exposing services (or remove it if you don't want to expose
psotgres outside the cluster).

Once the share is set up, next step is to set up the secrets that the system will use to access the share. Populate 
the username, password, and share path info into the `secrets.yaml` and `storageClass.yaml` files. You will probably 
also want to pick the database username/password for malwarETL to use to log into postgres, and populate those into 
`values.yaml`.

Once you have all that set up, you're ready to start installing. First, the namespace:

`kubectl apply -f namespace.yaml`

That will create the namespace for all of the rest of the deployment.

Next, the secrets:

`kubectl apply -f secrets.yaml -n postgres`

Note: modify the `-n postgres` part if you changed the name of the namespace.

Next, the storageClass:

`kubectl apply -f storageClass.yaml -n postgres`

Lastly, now that we have the secrets and storageClass set up, the final stage is the install, which is done with:
```
helm install --namespace postgres postgres-etl oci://registry-1.docker.io/bitnamicharts/postgresql -f values.yaml -n postgres
```

Once that's all done you should be able to see the database running in k8s :

`kubectl get pods -n postgres`

And you shoudl be able to attach to the db from outside (see the IP specified in values.yaml)