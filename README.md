# malwarETL-k8s
## K8s policies/setup files for malwarETL installation

This is a set of scripts and configurations to install k8s on a local bare-metal repo, which I then run malwarETL on 
top of. 

This has a few advantages: 
  1) kubespary + ansible means that adding/removing/updating nodes is done in a scripted way, rather than manually tweaking nodes.
  2) using kubespray means it's using kubeadm under the hood, we we're still getting the recommended settings for much of the node setup.

## Note on virtualbox

DO NOT use the virtualbox that's provided by Ubuntu. I had a bunch of problems with it. Install it from the .deb from 
virtualbox.org (or add their apt repo and install it via apt). I had to remove a lot of 
other auto-installed components after installing the ubuntu packaged version, as well. You should run: 
```
sudo apt-get remove virtualb*
sudo apt-get remove vbox*
```

in an empty directory before installing the virtualbox deb. Note: it will be tempting to run an `apt-get autoremove` or 
`apt-get clean` after uninstalling the virtualbox components...that's *technically* the right thing to do, but it will
remove a bunch of components that the deb will be looking for and won't trigger an installation of itself. The fact 
that a headless virtualization system needs a whole pile of xwindows stuff is somewhat sad, but here we are.

## Note on ubuntu interfaces

Ubuntu 18.04 (and probably later) install parts of lxc by default (which is part of why I started with LXC in this
whole saga). That includes some processes that create network interfaces for lxc automatically. That caused some confusion
when I would try to headlessly bring up vms with vagrant. (since vagrant would ask which interface to bridge to 
every time.) To disable those, I ended up running`systemctl disable libvirt-guests` and `systemctl disable libvirtd`. 
It's not strictly necessary to do that, you could just ignore them, but I didn't like having extra 
stuff confusing any troubleshooting, especially other virtualization systems that I wasn't using.

